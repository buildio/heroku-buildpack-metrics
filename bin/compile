#!/bin/bash

BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3

echo '-----> Copying required binaries statsdaemon, get-random-port'
# Ensure the bin folder exists, if not already.
mkdir -p ${BUILD_DIR}/bin

# Copy all binaries
cp bin/statsdaemon ${BUILD_DIR}/bin/
cp bin/get-random-port ${BUILD_DIR}/bin/
cp bin/metrics-poller ${BUILD_DIR}/bin/

echo '-----> Setting up .profile.d to automatically run the metrics daemon'
mkdir -p $BUILD_DIR/.profile.d
cp .profile.d/heroku-metrics-daemon.sh $BUILD_DIR/.profile.d

if [ -f $BUILD_DIR/pom.xml ]; then
  echo '-----> Installing Java metrics agent'
  curl --retry 3 -s -o $BUILD_DIR/bin/heroku-metrics-agent.jar -L https://lang-jvm.s3.amazonaws.com/heroku-metrics-agent.jar
fi
