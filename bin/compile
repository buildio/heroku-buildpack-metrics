#!/bin/bash

arrow() {
  echo '----->' "$@"
}

indent() {
  sed -u 's/^/       /'
}

BUILD_DIR=$1
#CACHE_DIR=$2
#ENV_DIR=$3

arrow "Setting up .profile.d to automatically run agentmon..."
mkdir -p "${BUILD_DIR}/.profile.d"
cp .profile.d/heroku-metrics-daemon.sh "${BUILD_DIR}/.profile.d"

if [[ -f "${BUILD_DIR}/pom.xml" ]] || [[ -f "${BUILD_DIR}/build.sbt" ]] || [[ -f "${BUILD_DIR}/build.gradle" ]]; then
    arrow "Installing Java metrics agent"
    mkdir -p "${BUILD_DIR}/bin/"
    curl --retry 3 -s -o "${BUILD_DIR}/bin/heroku-metrics-agent.jar" -L https://lang-jvm.s3.amazonaws.com/heroku-metrics-agent.jar
fi
